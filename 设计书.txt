

# ğŸ“‘ DataStage å®æˆ˜è®­ç»ƒç¬¬2å¤©ï¼šå…¨ä»»åŠ¡è®¾è®¡æ±‡æ€» (Design Document)

**é¡¹ç›®åç§°ï¼š** æ–‡ä»¶åä½œä¸æ•°æ®è½¬æ¢å®æˆ˜

**ç¼–å†™æ—¥æœŸï¼š** 2026-02-03

**ä½œè€…ï¼š** Gemini (AI åä½œ)

---

## ä»»åŠ¡ 1ï¼šCSV é”€å”®æ•°æ®é«˜çº§è½¬æ¢

**ç›®æ ‡**ï¼šå¯¹åŸå§‹é”€å”®æ•°æ®è¿›è¡Œåˆ—æ‰©å±•ã€æ ¼å¼æ ‡å‡†åŒ–åŠæ–‡æœ¬å¤„ç†ã€‚

### 1.1 æµç¨‹è®¾è®¡

`[Src_day2_sales_csv] -> [Transformer_1] -> [Tgt_day2_sales_transformed_csv]`

### 1.2 å…³é”®è½¬æ¢é€»è¾‘

* **å­—æ®µå¤§å†™åŒ–**ï¼š`customer_name` æ˜ å°„ä¸º `UpCase(Link_1.customer_name)`ã€‚
* **è®¡ç®—è¡ç”Ÿåˆ—**ï¼š`total_amount` å®šä¹‰ä¸º `Link_1.quantity * Link_1.unit_price`ã€‚
* **æ—¥æœŸé‡æ ¼å¼åŒ–**ï¼šå°† `YYYY-MM-DD` è½¬æ¢ä¸º `YYYYå¹´MMæœˆDDæ—¥`ã€‚
* *æ³¨ï¼šè¾“å‡ºåˆ—å¿…é¡»è®¾ç½®ä¸º `VARCHAR(30)` ä»¥å®¹çº³ä¸­æ–‡å­—ç¬¦ï¼Œè‹¥è®¾ä¸º `DATE` ä¼šå¯¼è‡´ä½œä¸šä¸­æ­¢ã€‚*



### 1.3 æ ¸å¿ƒé…ç½®æç¤º

* **å†™æ“ä½œ**ï¼šè®¾ç½®æ–‡ä»¶æ›´æ–°æ–¹å¼ä¸º **è¦†ç›– (Overwrite)**ï¼Œç¡®ä¿ä½œä¸šå¯é‡å¤è¿è¡Œã€‚
* **ç±»å‹æ£€æŸ¥**ï¼šç¡®ä¿ `total_amount` ä¸º `DECIMAL` ç±»å‹ä»¥ä¿è¯è®¡ç®—ç²¾åº¦ã€‚

---

## ä»»åŠ¡ 2ï¼šXML äº§å“æ•°æ®è§£æ

**ç›®æ ‡**ï¼šå°†åˆ†å±‚ XML ç»“æ„å¹³é“ºä¸ºå¹³é¢ CSV æ ¼å¼ï¼Œå¹¶è®¡ç®—åº“å­˜ä»·å€¼ã€‚

### 2.1 æµç¨‹è®¾è®¡

`[Src_day2_products_xml] -> [Hierarchical_Data_1] -> [Tgt_day2_products_csv]`

### 2.2 è§£æä¸æ˜ å°„æ­¥éª¤

* **ç¨‹åºé›†ç¼–è¾‘å™¨ (Assembly Editor)**ï¼šé€šè¿‡â€œç¼–è¾‘ç»„ä»¶ä»¶â€è¿›å…¥å…¨å±é…ç½®ç•Œé¢ã€‚
* **XML Parser**ï¼šå¯¼å…¥ `day2_products.xml` æ¶æ„ï¼Œå°† XML æ ‘çŠ¶ç»“æ„æ˜ å°„åˆ°è¾“å‡ºé“¾æ¥ã€‚
* **è¡ç”Ÿè®¡ç®—**ï¼šåœ¨æ˜ å°„æ­¥éª¤ä¸­åˆ›å»º `inventory_value`ï¼Œè¡¨è¾¾å¼ä¸º `price * stock`ã€‚

### 2.3 æŠ€æœ¯è¦ç‚¹

* **è¾“å…¥é•¿åº¦**ï¼šæºèŠ‚ç‚¹çš„ XML å†…å®¹å­—æ®µéœ€è®¾ä¸º `VARCHAR(MAX)`ï¼Œé˜²æ­¢å†…å®¹è¢«æˆªæ–­å¯¼è‡´è§£æå¤±è´¥ã€‚
* **ç¼–ç ä¸€è‡´æ€§**ï¼šXML å£°æ˜ä¸º `UTF-8`ï¼Œä½œä¸š NLS è®¾ç½®éœ€åŒæ­¥ï¼Œé¿å…äº§å“åç§°ä¹±ç ã€‚

---

## ä»»åŠ¡ 3ï¼šå›ºå®šé•¿åº¦ TXT å®¢æˆ·æ•°æ®å¤„ç†

**ç›®æ ‡**ï¼šåŸºäºç‰©ç†ä½ç½®è§£ææ— å®šç•Œç¬¦çš„ TXT æ–‡ä»¶ï¼Œå¹¶å¯¼å‡ºå¸¦è¡¨å¤´çš„ CSVã€‚

### 3.1 æµç¨‹è®¾è®¡

`[Src_day2_customers_txt] -> [Tgt_day2_customers_parsed_csv]`

### 3.2 å­—æ®µå¸ƒå±€å®šä¹‰ (Schema)

| å­—æ®µå | èµ·å§‹ä½ç½® | é•¿åº¦ (å­—èŠ‚) | ç±»å‹ |
| --- | --- | --- | --- |
| `customer_id` | 1 | 3 | VarChar |
| `customer_name` | 4 | 10 | VarChar |
| `prefecture` | 14 | 8 | VarChar |
| `phone` | 22 | 13 | VarChar |

### 3.3 å…³é”®å‚æ•°è®¾ç½®

* **å®šç•Œç¬¦**ï¼šæºèŠ‚ç‚¹å­—æ®µå®šç•Œç¬¦è®¾ä¸º **æ—  (None)**ã€‚
* **æ•°æ®æ¸…æ´—**ï¼šåœ¨åˆ—å±æ€§ä¸­è®¾ç½® **è£å‰ª (Trim)** ä¸º `Both`ï¼Œè‡ªåŠ¨å»é™¤å›ºå®šé•¿å¡«å……äº§ç”Ÿçš„å¤šä½™ç©ºæ ¼ã€‚
* **è¾“å‡ºè¡¨å¤´**ï¼šåœ¨ç›®æ ‡ CSV èŠ‚ç‚¹å¼€å¯ **ç¬¬ä¸€è¡ŒåŒ…å«åˆ—å (First line is column names)** é€‰é¡¹ï¼Œå°†æ‰‹åŠ¨å®šä¹‰çš„åˆ—åå†™å…¥æ–‡ä»¶é¦–è¡Œã€‚

---

## ğŸ›  æ•…éšœæ’é™¤æ€»ç»“ (Lessons Learned)

åœ¨ä»Šå¤©çš„ç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬è§£å†³äº†ä¸€ä¸ªä¸¥é‡çš„ **Internal Error (minIndex < m_outputLinkObjArraySize)**ã€‚

* **æ ¹æœ¬åŸå› **ï¼šå½“é¢‘ç¹ä¿®æ”¹ Transformer çš„è¾“å‡ºåˆ—æˆ–æ•°æ®ç±»å‹æ—¶ï¼Œåº•å±‚ç´¢å¼•ä¼šå‘ç”Ÿå†²çªã€‚
* **è§£å†³æ–¹æ¡ˆ**ï¼šå½»åº•åˆ é™¤åŸæœ‰è¿çº¿å¹¶é‡æ‹‰ï¼Œæˆ–åˆ é™¤ç›®æ ‡èŠ‚ç‚¹é‡æ–°é…ç½®ï¼Œä»¥å¼ºè¡Œé‡ç½® DataStage å¼•æ“çš„æ‰§è¡Œè®¡åˆ’ã€‚

---
